#!/bin/bash

# Update code
cd /app
git pull origin main

# Update dependencies
/home/useradmin/app/venv/bin/pip install -r requirements.txt

# Create or update service files
cat << EOF | sudo tee /etc/systemd/system/fastapi.service
[Unit]
Description=FastAPI Service
After=network.target

[Service]
User=useradmin
WorkingDirectory=/home/useradmin/app
ExecStart=/home/useradmin/app/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000
Restart=always
Environment="PATH=/home/useradmin/app/venv/bin"

[Install]
WantedBy=multi-user.target
EOF



# Set correct permissions
sudo chmod 644 /etc/systemd/system/fastapi.service


# Reload systemd, enable and restart services
sudo systemctl daemon-reload
sudo systemctl enable fastapi.service
sudo systemctl restart fastapi.service





















